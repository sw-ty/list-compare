<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Comparator (web)</title>
    <!-- Load Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <style>
        /* Custom styles for the Bootstrap theme */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa; /* Light gray background */
        }
        .app-container {
            padding-top: 2rem;
            padding-bottom: 2rem;
            min-height: 100vh;
        }
        .shadow-custom {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
        textarea:focus, input[type="file"]:focus {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); /* Primary focus ring */
        }
    </style>
</head>
<body>
    <!-- Bootstrap JS Bundle (required for components like tooltips/popovers if used, good practice to include) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <div id="app" class="app-container d-flex justify-content-center align-items-start">
        <div class="container bg-white rounded-3 shadow-custom p-4 p-md-5" style="max-width: 900px;">

            <header class="text-center mb-5">
                <h1 class="display-5 fw-bold text-dark mb-2">List Comparison Tool</h1>
                <p class="lead text-secondary">Find common items in List A that exist in List B.</p>
            </header>

            <!-- Input Section -->
            <div class="row g-4 mb-4">

                <!-- List A (Source) - Left on wide screens -->
                <div class="col-md-6">
                    <div class="p-4 rounded-3 border border-primary-subtle" style="background-color: #e9effd;">
                        <h2 class="h5 text-primary mb-3">List A (Source)</h2>
                        <p class="small text-muted mb-3">Items here will be checked against List B.</p>

                        <div class="mb-3">
                            <label class="form-label small fw-medium text-dark">Upload File (.txt, line-separated):</label>
                            <input type="file" id="fileA" accept=".txt" class="form-control form-control-sm">
                        </div>

                        <div class="mb-0">
                            <label for="textA" class="form-label small fw-medium text-dark">Or enter items manually (one item per line):</label>
                            <textarea id="textA" rows="10" class="form-control" placeholder="Enter list A items here..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- List B (Reference) - Right on wide screens -->
                <div class="col-md-6">
                    <div class="p-4 rounded-3 border border-success-subtle" style="background-color: #e6f7ee;">
                        <h2 class="h5 text-success mb-3">List B (Reference)</h2>
                        <p class="small text-muted mb-3">This list is used for reference/lookup.</p>

                        <div class="mb-3">
                            <label class="form-label small fw-medium text-dark">Upload File (.txt, line-separated):</label>
                            <input type="file" id="fileB" accept=".txt" class="form-control form-control-sm">
                        </div>

                        <div class="mb-0">
                            <label for="textB" class="form-label small fw-medium text-dark">Or enter items manually (one item per line):</label>
                            <textarea id="textB" rows="10" class="form-control" placeholder="Enter list B items here..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control and Status -->
            <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mb-5">
                <div class="d-flex flex-column flex-sm-row gap-3">
                    <button id="compareBtn" class="btn btn-primary btn-lg rounded-pill px-5 fw-bold shadow-sm">
                        Compare Lists
                    </button>
                    <button id="clearBtn" class="btn btn-outline-secondary btn-lg rounded-pill px-5 fw-bold shadow-sm">
                        Clear All
                    </button>
                </div>
                <div id="statusMessage" class="text-secondary small fw-medium mt-3 mt-sm-0">
                    Ready to compare.
                </div>
            </div>

            <!-- Result Section -->
            <div class="mt-4 pt-4 border-top">
                <h2 class="h4 fw-bold text-dark mb-3">Results</h2>
                <div id="resultContainer" class="p-3 rounded-3 border bg-light">
                    <p id="matchCount" class="text-secondary fw-medium mb-3">No matches found yet.</p>
                    <textarea id="resultTextarea" rows="10" readonly class="form-control font-monospace bg-white border-secondary"></textarea>
                    <button id="copyBtn" class="btn btn-outline-primary btn-sm mt-3" style="display: none;">
                        Copy Results
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- Core Application Logic ---

        // Get DOM elements
        const fileAInput = document.getElementById('fileA');
        const fileBInput = document.getElementById('fileB');
        const textAInput = document.getElementById('textA');
        const textBInput = document.getElementById('textB');
        const compareBtn = document.getElementById('compareBtn');
        const clearBtn = document.getElementById('clearBtn'); // New button element
        const statusMessage = document.getElementById('statusMessage');
        const resultTextarea = document.getElementById('resultTextarea');
        const matchCount = document.getElementById('matchCount');
        const copyBtn = document.getElementById('copyBtn');

        /**
         * Reads a file and returns its content as a promise.
         * @param {File} file The file object to read.
         * @returns {Promise<string>} A promise that resolves with the file's text content.
         */
        function readFileAsync(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(new Error('Error reading file.'));
                reader.readAsText(file);
            });
        }

        /**
         * Extracts data from a list input (either file or textarea).
         * @param {'A' | 'B'} listId Identifier for the list.
         * @returns {Promise<string[]>} A promise resolving to an array of trimmed, non-empty lines.
         */
        async function getListData(listId) {
            const fileInput = listId === 'A' ? fileAInput : fileBInput;
            const textInput = listId === 'A' ? textAInput : textBInput;
            let rawText = '';

            // 1. Check for file upload first
            if (fileInput.files.length > 0) {
                try {
                    statusMessage.textContent = `Reading file for List ${listId}...`;
                    rawText = await readFileAsync(fileInput.files[0]);
                } catch (error) {
                    throw new Error(`Could not read file for List ${listId}.`);
                }
            }
            // 2. Fallback to manual text input
            else {
                rawText = textInput.value;
            }

            // Process the text: split by line, trim whitespace, and filter out empty lines
            return rawText
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
        }

        /**
         * The core logic to compare List A against List B.
         * Finds all items in List A that are present in List B.
         * @param {string[]} listA The source list (to be checked).
         * @param {string[]} listB The reference list (for lookup).
         * @returns {string[]} An array of matching items.
         */
        function compareLists(listA, listB) {
            // Use a Set for List B for O(1) average time complexity lookups
            const setB = new Set(listB);
            const matches = [];

            // Use a Set to track which items from List A have already been matched and added
            const addedMatches = new Set();

            for (const item of listA) {
                // Check if the item from A exists in the B set
                if (setB.has(item)) {
                    // Only add if it hasn't been added yet (handles duplicates in List A)
                    if (!addedMatches.has(item)) {
                        matches.push(item);
                        addedMatches.add(item);
                    }
                }
            }

            return matches;
        }

        /**
         * Event handler for the Compare button click.
         */
        async function handleCompare() {
            compareBtn.disabled = true;
            statusMessage.textContent = 'Processing...';
            matchCount.textContent = 'Searching for matches...';
            resultTextarea.value = '';
            copyBtn.style.display = 'none';

            try {
                // 1. Get both lists
                const listA = await getListData('A');
                const listB = await getListData('B');

                if (listA.length === 0 || listB.length === 0) {
                    throw new Error('Please provide content for both List A and List B.');
                }

                statusMessage.textContent = `Comparing ${listA.length} items (List A) against ${listB.length} items (List B)...`;

                // 2. Perform comparison
                const matches = compareLists(listA, listB);

                // 3. Update results
                const resultOutput = matches.join('\n');
                resultTextarea.value = resultOutput;
                matchCount.textContent = `Found ${matches.length} unique match(es) in List A and List B.`;
                statusMessage.textContent = 'Comparison complete.';

                if (matches.length > 0) {
                    copyBtn.style.display = 'inline-block';
                }

            } catch (error) {
                // Display error message to the user and in the console
                const errorMessage = error.message || 'An unknown error occurred during comparison.';
                statusMessage.textContent = `Error: ${errorMessage}`;
                matchCount.textContent = 'Comparison failed.';
                console.error(error);
            } finally {
                compareBtn.disabled = false;
            }
        }

        /**
         * Clears all inputs and results.
         */
        function handleClear() {
            // Clear text areas
            textAInput.value = '';
            textBInput.value = '';
            resultTextarea.value = '';

            // Clear file inputs (must reset value property)
            fileAInput.value = '';
            fileBInput.value = '';
            
            // Reset result display
            matchCount.textContent = 'No matches found yet.';
            statusMessage.textContent = 'All inputs cleared. Ready to compare.';
            copyBtn.style.display = 'none';
            compareBtn.disabled = false;
        }

        /**
         * Clears text input when a file is selected, and vice versa.
         * @param {Event} e The change event.
         */
        function syncInputs(e) {
            const isFile = e.target.type === 'file';
            const targetId = e.target.id;

            if (targetId === 'fileA') {
                textAInput.value = isFile && e.target.files.length > 0 ? '' : textAInput.value;
            } else if (targetId === 'textA') {
                fileAInput.value = !isFile && e.target.value.length > 0 ? '' : fileAInput.value;
            } else if (targetId === 'fileB') {
                textBInput.value = isFile && e.target.files.length > 0 ? '' : textBInput.value;
            } else if (targetId === 'textB') {
                fileBInput.value = !isFile && e.target.value.length > 0 ? '' : fileBInput.value;
            }
        }

        /**
         * Copies the results to the clipboard.
         */
        function copyResults() {
            const textToCopy = resultTextarea.value;
            if (textToCopy) {
                // Fallback for secure context issues in iframes
                try {
                    resultTextarea.select();
                    document.execCommand('copy');
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => {
                        copyBtn.textContent = 'Copy Results';
                    }, 2000);
                } catch (err) {
                    console.error('Copy failed: ', err);
                    statusMessage.textContent = 'Error: Could not copy text (browser restriction). Please select and copy manually.';
                }
            }
        }


        // --- Event Listeners ---
        fileAInput.addEventListener('change', syncInputs);
        textAInput.addEventListener('input', syncInputs);
        fileBInput.addEventListener('change', syncInputs);
        textBInput.addEventListener('input', syncInputs);
        compareBtn.addEventListener('click', handleCompare);
        clearBtn.addEventListener('click', handleClear); // Add event listener for the new clear button
        copyBtn.addEventListener('click', copyResults);

    </script>
</body>
</html>

